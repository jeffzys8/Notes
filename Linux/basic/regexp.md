# 正则表达式

- 用于字符串的 查找/替换/删除 工作，它是个文法不是一个程序，要用支持这种文法的程序（`sed`, `awk`等）
- 拓展正则表达式：支持 and or 之类的
- **命令要加`' '`表明字符串**
- 通配符和正则不一样！有冲突
  - 比如`*`通配任意字符，而正则里是重复前一个字符0+次
  - 通配符见[bash笔记](bash.md)

## 特殊符号

使用正则表达式要注意语系环境，否则编码不同选出来的范围可能不同。为此，有一些特殊符号可以用于代替 `[AZ]` 这样的表达：
|符号|含义|
|--|--|
|[:alnum:]|	代表英文大小写字元及数字，亦即0-9, AZ, az
|[:alpha:]|	代表任何英文大小写字元，亦即AZ, az
|[:blank:]|	代表空白键与[Tab] 按键两者
|[:cntrl:]|	代表键盘上面的控制按键，亦即包括CR, LF, Tab, Del.. 等等
|[:digit:]|	代表数字而已，亦即0-9
|[:graph:]|	除了空白字元(空白键与[Tab] 按键) 外的其他所有按键
|[:lower:]|	代表小写字元，亦即az
|[:print:]|	代表任何可以被列印出来的字元
|[:punct:]|	代表标点符号(punctuation symbol)，亦即：" ' ? ! ; : # $...
|[:upper:]|	代表大写字元，亦即AZ
|[:space:]|	任何会产生空白的字元，包括空白键, [Tab], CR 等等
|[:xdigit:]|	代表16 进位的数字类型，因此包括： 0-9, AF, af 的数字与字元

## 基本正则语法

- `[]` 匹配括号里的一个字符，
  - 比如`[asd]`
  - `[a-z]`可以匹配范围，但要看语系编码
  - 用特殊符号的话就类似 `[[:alnum:]]`的形式
  - `[^..]`反选（注意这里的^是中括号内）
- `^` 匹配首，`$` 匹配尾
  - `^` 写在开头
  - `$` 写在末尾
  - `^$` 匹配空行**
  - 例：行尾为小数点 `\.$` 因为 `.`有特殊含义需要转义
- `.`任意一个字符，`*`前一个字符0+次
  - 例：g开头，g结尾，中间任意字符：不是`'g*g'`！会把单个g也匹配了，应该是`'g.*g'`
- `{}`限定范围内的连续字符数量
  - 要加上`\`转义(why?) 比如 `o\{2,5\}` 表示2-5个o

> 再次强调！不要把bash的通配符和正则表达式混在一起了！

## 拓展正则语法

- `grep -E` == `egrep`
- `+` 1个或以上该字符
- `?` 0个或1个该字符
- `|` 或
  - `egrep -n 'gd|good' regular_express.txt`
  - `egrep -n 'gd|good|dog' regular_express.txt`
- `()` 把字符串当字符处理，整个匹配（用以配合 '|'）
  - `egrep -n 'g(la|oo)d' regular_express.txt`
- `()+` 多个重复字符串

## `sed`

sed 可将资料进行取代、删除、新增、选取特定行等等

- 选取 `p`:
    ```sh
    nl /etc/passwd | sed -n '5,7p' # -n 必须带上
    ```
- 删除 `d`:
    ```sh
    nl /etc/passwd | sed '2d' # 删除 2 行
    nl /etc/passwd | sed '2,5d' # 删除 2-5 行
    nl /etc/passwd | sed '3,$d' # 删除 3-last 行
    nl /etc/passwd | sed '/str/d' # 删除匹配str的行
    ```
- 覆盖 `c`:
    ```sh
    nl /etc/passwd | sed '2,5c No 2-5 number' # 4行会被替换成1行内容
    ```
- 下方插入 `a`:
    ```sh
    nl /etc/passwd | sed '2a drink tea'
    nl /etc/passwd | sed '2a drink tea or .....\
    drink beer' # 增加了两行
    ```
- 上方插入 `i`:
    ```sh
    nl /etc/passwd | sed '2,5i drink tea'
    ```
- 内容替换 `s/old/new/g`:
    ```sh
    sed 's/要被取代的字串/新的字串/g'
    ```
- 直接修改文件内容（**危险**）`-i`

## `printf`

格式化输出

```
选项与参数：
关于格式方面的几个特殊样式：
       \a 警告声音输出
       \b 倒退键(backspace)
       \f 清除萤幕(form feed)
       \n 输出新的一行
       \r 亦即Enter 按键
       \t 水平的[tab] 按键
       \v 垂直的[tab] 按键
       \xNN NN 为两位数的数字，可以转换数字成为字元。
关于C 程式语言内，常见的变数格式
       %ns 那个n 是数字， s 代表string ，亦即多少个字元；
       %ni 那个n 是数字， i 代表integer ，亦即多少整数位数；
       %N.nf 那个n 与N 都是数字， f 代表floating (浮点)，如果有小数位数，
             假设我共要十个位数，但小数点有两位，即为%10.2f 啰！
```

## `awk`


逐行以列为最小单位处理数据

> awk实际上是一门语言，支持相当多的复杂操作。GNU实现了符合该语法规范的Linux程序 `gawk`，现在centos的`awk`-->`gawk`。这里只是介绍最常见的用法。

```sh
awk '条件类型1{动作1}条件类型2{动作2} ...' filename
```
- `$0` 表示整行数据，`$1`开始表示某一列的数据
- `NF` 当前行的列数，`NR` 当前行数，`FS` 分隔符
- 例：不带条件判断的简单例子
  ```sh
  last -n 5| awk '{print $1 "\t lines: " NR "\t columns: " NF}'
  ```
- 例：预设分隔符要用`BEGIN`否则第一行会维持默认的分隔符（空格或\t）
  ```sh
  cat /etc/passwd | awk 'BEGIN {FS=":"} $3 < 10 {print $1 "\t " $3}'
  ```
  同样的也有`END`用作后处理
- 例：实现复杂的计算任务
  ```sh
  $ cat pay.txt | \ 
  > awk 'NR==1{printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"Total" } 
  > NR>=2{total = $2 + $3 + $4 
  > printf "%10s %10d %10d %10d %10.2f\n", $1, $2, $3, $4, total}'
  ```
  - 中间的`total`是变量，像python一样易用
  - 同个`{}`的不同指令要用`;`或者`换行`分开
  - 使用`printf`的话要自己`\n`换行
- 还可以进行循环操作，此处先不展开，用到再说。